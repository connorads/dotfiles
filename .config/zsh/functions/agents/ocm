#!/usr/bin/env zsh
# ocm: enable selected MCPs in opencode config
emulate -L zsh

local cfg="$HOME/.config/opencode/opencode.json"
local sel=$(jq -r '.mcp|keys[]' "$cfg" | fzf -m --prompt="MCPs to enable > ")
[[ -z "$sel" ]] && return
local tmp=$(mktemp)
local filter='.mcp |= with_entries(.value.enabled = false)'
while IFS= read -r mcp; do
  filter="$filter | .mcp[\"$mcp\"].enabled = true"
done <<< "$sel"
jq "$filter" "$cfg" > "$tmp" && mv "$tmp" "$cfg"

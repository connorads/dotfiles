#!/usr/bin/env zsh
# webtermup: expose tmux session via webmux serve + Tailscale serve
emulate -L zsh
local session=${1:-main}
local port=${2:-7681}

pkill -f "webmux serve.*--port $port" 2>/dev/null
pkill -f "ttyd.*--port $port" 2>/dev/null

webmux serve --port $port -- tmux new-session -A -s "$session" &!

ts serve --bg $port
local hostname=$(ts status --self --json | jq -r '.Self.DNSName' | sed 's/\.$//')
echo "Terminal ($session): https://$hostname"

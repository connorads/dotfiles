#!/usr/bin/env zsh
# webtermup: expose tmux session via webmux serve + Tailscale serve
emulate -L zsh
local session=${1:-main}
local port=${2:-7681}

if pkill -f "webmux serve.*--port $port" 2>/dev/null || pkill -f "ttyd.*--port $port" 2>/dev/null; then
  print -u2 "stopped previous webterm on :$port"
fi

webmux serve --no-sleep --port $port -- tmux new-session -A -s "$session" &!

ts serve --bg $port
local hostname
hostname=$(ts-hostname) || return 1
echo "Terminal ($session): https://$hostname"

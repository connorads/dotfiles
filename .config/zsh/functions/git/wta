# wta: add a worktree under ~/.trees for a branch
# usage: wta <branch>
emulate -L zsh
local branch=$1
local repo=$(basename $(git rev-parse --show-toplevel))
local worktree_path="$HOME/.trees/${repo}-${branch}"

git fetch origin 2>/dev/null || echo "warning: fetch failed, using local refs only"

# Check if branch exists locally or remotely
if git show-ref --verify --quiet refs/heads/$branch; then
  # Local branch exists - checkout existing
  git worktree add "$worktree_path" "$branch" && cd "$worktree_path"
elif git show-ref --verify --quiet refs/remotes/origin/$branch; then
  # Remote branch exists - track it
  git worktree add "$worktree_path" -b "$branch" "origin/$branch" && cd "$worktree_path"
else
  # New branch - create from current HEAD
  git worktree add -b "$branch" "$worktree_path" && cd "$worktree_path"
fi

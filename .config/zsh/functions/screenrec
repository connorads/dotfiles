#!/usr/bin/env zsh
# screenrec: record screen + system audio via BlackHole
emulate -L zsh

local output="${1:-$HOME/Desktop/screenrec-$(date +%Y%m%d-%H%M%S).mp4}"

echo "Recording to: $output"
echo "Press 'q' to stop recording"
echo ""
echo "Make sure sound output is set to your Multi-Output Device"
echo "(System Settings > Sound > Output > Loopback)"
echo ""

ffmpeg -f avfoundation -pixel_format nv12 -framerate 30 -i "Capture screen 0:BlackHole 16ch" \
  -vf scale=1920:1080 -c:v libx264 -crf 23 -preset ultrafast \
  -ac 2 -c:a aac -b:a 128k \
  "$output"
